summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
persian.UCLA = na.omit(persian.UCLA)
persian.UCLA$Ethnicity = "Persian"
caucasian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 2)[,2:12]
caucasian = na.omit(caucasian)
alldata = rbind(persian.UCLA, caucasian)
persian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 3)[,2:9]
persian$Age = as.numeric(alldata %>% filter(Ethnicity == "Persian" & Sex == "M") %>% summarise(Age = median(Age)))
persian$Ethnicity = "Persian"
newAll = rbind(alldata[,c(11,2,5:10,1)], persian)
newTwo = alldata[,c(11,2,5:10,1)]
write.csv(newTwo,file="complete.csv")
newTwo$Ethnicity = as.factor(newTwo$Ethnicity)
newAll$Ethnicity = as.factor(newAll$Ethnicity)
persian$Ethnicity = as.factor(persian$Ethnicity)
male = newTwo %>% filter(Sex == "M")
female = newTwo %>% filter(Sex == "F")
smp_siz = floor(0.8*nrow(newTwo))
set.seed(684323)
train_ind = sample(seq_len(nrow(newTwo)),size = smp_siz)
train = newTwo[train_ind,]
test = newTwo[-train_ind,]
write.csv(train,file="ann_train.csv")
write.csv(test,file="ann_test.csv")
smp_siz = floor(0.8*nrow(male))
train_ind = sample(seq_len(nrow(male)),size = smp_siz)
trainMale = male[train_ind,]
testMale = male[-train_ind,]
smp_siz = floor(0.8*nrow(female))
train_ind = sample(seq_len(nrow(female)),size = smp_siz)
trainFemale = female[train_ind,]
testFemale = female[-train_ind,]
# All
m1 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age + Sex, data = train, family = "binomial")
m2 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` + Age + Sex, data = train, family = "binomial")
m3 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` * Age * Sex, data = train, family = "binomial")
# Male/Female
m4 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainFemale , family = "binomial")
m5 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainMale , family = "binomial")
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
confusionMatrix(table(predict(m1,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m2,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m3,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m4,testFemale[,1:8],type = 'response') >=0.5,testFemale$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m5,testMale[,1:8],type = 'response') >=0.5,testMale$Ethnicity=="Persian"))[3]
## run random effect model to see how the measures are differed by Ethnicity
random_effect_data <- read_csv("./random_effect_data.csv")
random_effect_MRD = lme(`MRD` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB = lme(`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_TPS = lme(`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_TPS = lme(`MRD`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_PTB = lme(`MRD`/`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB_TPS = lme(`PTB`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
summary(random_effect_MRD)
summary(random_effect_PTB)
summary(random_effect_TPS)
summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("/Users/jinyi/Downloads/PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
setwd("~/Desktop/STATS-141SL")
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
persian.UCLA = na.omit(persian.UCLA)
persian.UCLA$Ethnicity = "Persian"
caucasian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 2)[,2:12]
caucasian = na.omit(caucasian)
alldata = rbind(persian.UCLA, caucasian)
persian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 3)[,2:9]
persian$Age = as.numeric(alldata %>% filter(Ethnicity == "Persian" & Sex == "M") %>% summarise(Age = median(Age)))
persian$Ethnicity = "Persian"
newAll = rbind(alldata[,c(11,2,5:10,1)], persian)
newTwo = alldata[,c(11,2,5:10,1)]
write.csv(newTwo,file="complete.csv")
newTwo$Ethnicity = as.factor(newTwo$Ethnicity)
newAll$Ethnicity = as.factor(newAll$Ethnicity)
persian$Ethnicity = as.factor(persian$Ethnicity)
male = newTwo %>% filter(Sex == "M")
female = newTwo %>% filter(Sex == "F")
# All Data
corrplot(cor(newTwo[,c(1,3:8)]))
# Caucasian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Caucasian"),c(1,3:8)]))
# Persian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Persian"),c(1,3:8)]))
# Male
corrplot(cor(male[,c(1,3:8)]))
# Female
corrplot(cor(female[,c(1,3:8)]))
#Investigate linear relation between age and MRD
ggplot(newTwo, aes(x=`MRD-1 (L)`, y=Age,fill=Ethnicity)) + geom_point(aes(color=Ethnicity)) + theme_classic()
ggplot(newAll, aes(x=`MRD-1 (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`MRD-1(R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(male, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
dat_male=data.frame(age=male$Age,'MRD-1(R)/TPS(R) of Male'=male$`MRD-1(R)`/male$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=male$`MRD-1(R)`/male$`PTB (R)`,'PTB(R)/TPS(R)'=male$`PTB (R)`/male$`TPS (R)`)
corrplot(cor(dat_male))
dat_female=data.frame(age=female$Age,'MRD-1(R)/TPS(R) of Male'=female$`MRD-1(R)`/female$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=female$`MRD-1(R)`/female$`PTB (R)`,'PTB(R)/TPS(R)'=female$`PTB (R)`/female$`TPS (R)`)
corrplot(cor(dat_female))
smp_siz = floor(0.8*nrow(newTwo))
set.seed(684323)
train_ind = sample(seq_len(nrow(newTwo)),size = smp_siz)
train = newTwo[train_ind,]
test = newTwo[-train_ind,]
write.csv(train,file="ann_train.csv")
write.csv(test,file="ann_test.csv")
smp_siz = floor(0.8*nrow(male))
train_ind = sample(seq_len(nrow(male)),size = smp_siz)
trainMale = male[train_ind,]
testMale = male[-train_ind,]
smp_siz = floor(0.8*nrow(female))
train_ind = sample(seq_len(nrow(female)),size = smp_siz)
trainFemale = female[train_ind,]
testFemale = female[-train_ind,]
# All
m1 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age + Sex, data = train, family = "binomial")
m2 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` + Age + Sex, data = train, family = "binomial")
m3 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` * Age * Sex, data = train, family = "binomial")
# Male/Female
m4 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainFemale , family = "binomial")
m5 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainMale , family = "binomial")
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
confusionMatrix(table(predict(m1,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m2,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m3,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m4,testFemale[,1:8],type = 'response') >=0.5,testFemale$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m5,testMale[,1:8],type = 'response') >=0.5,testMale$Ethnicity=="Persian"))[3]
## run random effect model to see how the measures are differed by Ethnicity
random_effect_data <- read_csv("./random_effect_data.csv")
random_effect_MRD = lme(`MRD` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB = lme(`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_TPS = lme(`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_TPS = lme(`MRD`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_PTB = lme(`MRD`/`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB_TPS = lme(`PTB`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
summary(random_effect_MRD)
summary(random_effect_PTB)
summary(random_effect_TPS)
summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
persian.UCLA = na.omit(persian.UCLA)
persian.UCLA$Ethnicity = "Persian"
caucasian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 2)[,2:12]
caucasian = na.omit(caucasian)
alldata = rbind(persian.UCLA, caucasian)
persian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 3)[,2:9]
persian$Age = as.numeric(alldata %>% filter(Ethnicity == "Persian" & Sex == "M") %>% summarise(Age = median(Age)))
persian$Ethnicity = "Persian"
newAll = rbind(alldata[,c(11,2,5:10,1)], persian)
newTwo = alldata[,c(11,2,5:10,1)]
write.csv(newTwo,file="complete.csv")
newTwo$Ethnicity = as.factor(newTwo$Ethnicity)
newAll$Ethnicity = as.factor(newAll$Ethnicity)
persian$Ethnicity = as.factor(persian$Ethnicity)
male = newTwo %>% filter(Sex == "M")
female = newTwo %>% filter(Sex == "F")
# All Data
corrplot(cor(newTwo[,c(1,3:8)]))
# Caucasian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Caucasian"),c(1,3:8)]))
# Persian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Persian"),c(1,3:8)]))
# Male
corrplot(cor(male[,c(1,3:8)]))
# Female
corrplot(cor(female[,c(1,3:8)]))
#Investigate linear relation between age and MRD
ggplot(newTwo, aes(x=`MRD-1 (L)`, y=Age,fill=Ethnicity)) + geom_point(aes(color=Ethnicity)) + theme_classic()
ggplot(newAll, aes(x=`MRD-1 (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`MRD-1(R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(male, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
dat_male=data.frame(age=male$Age,'MRD-1(R)/TPS(R) of Male'=male$`MRD-1(R)`/male$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=male$`MRD-1(R)`/male$`PTB (R)`,'PTB(R)/TPS(R)'=male$`PTB (R)`/male$`TPS (R)`)
corrplot(cor(dat_male))
dat_female=data.frame(age=female$Age,'MRD-1(R)/TPS(R) of Male'=female$`MRD-1(R)`/female$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=female$`MRD-1(R)`/female$`PTB (R)`,'PTB(R)/TPS(R)'=female$`PTB (R)`/female$`TPS (R)`)
corrplot(cor(dat_female))
smp_siz = floor(0.8*nrow(newTwo))
set.seed(684323)
train_ind = sample(seq_len(nrow(newTwo)),size = smp_siz)
train = newTwo[train_ind,]
test = newTwo[-train_ind,]
write.csv(train,file="ann_train.csv")
write.csv(test,file="ann_test.csv")
smp_siz = floor(0.8*nrow(male))
train_ind = sample(seq_len(nrow(male)),size = smp_siz)
trainMale = male[train_ind,]
testMale = male[-train_ind,]
smp_siz = floor(0.8*nrow(female))
train_ind = sample(seq_len(nrow(female)),size = smp_siz)
trainFemale = female[train_ind,]
testFemale = female[-train_ind,]
# All
m1 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age + Sex, data = train, family = "binomial")
m2 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` + Age + Sex, data = train, family = "binomial")
m3 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` * Age * Sex, data = train, family = "binomial")
# Male/Female
m4 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainFemale , family = "binomial")
m5 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainMale , family = "binomial")
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
confusionMatrix(table(predict(m1,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m2,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m3,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m4,testFemale[,1:8],type = 'response') >=0.5,testFemale$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m5,testMale[,1:8],type = 'response') >=0.5,testMale$Ethnicity=="Persian"))[3]
## run random effect model to see how the measures are differed by Ethnicity
random_effect_data <- read_csv("./random_effect_data.csv")
random_effect_MRD = lme(`MRD` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB = lme(`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_TPS = lme(`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_TPS = lme(`MRD`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_PTB = lme(`MRD`/`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB_TPS = lme(`PTB`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
summary(random_effect_MRD)
summary(random_effect_PTB)
summary(random_effect_TPS)
summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
persian.UCLA = na.omit(persian.UCLA)
persian.UCLA$Ethnicity = "Persian"
caucasian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 2)[,2:12]
caucasian = na.omit(caucasian)
alldata = rbind(persian.UCLA, caucasian)
persian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 3)[,2:9]
persian$Age = as.numeric(alldata %>% filter(Ethnicity == "Persian" & Sex == "M") %>% summarise(Age = median(Age)))
persian$Ethnicity = "Persian"
newAll = rbind(alldata[,c(11,2,5:10,1)], persian)
newTwo = alldata[,c(11,2,5:10,1)]
write.csv(newTwo,file="complete.csv")
newTwo$Ethnicity = as.factor(newTwo$Ethnicity)
newAll$Ethnicity = as.factor(newAll$Ethnicity)
persian$Ethnicity = as.factor(persian$Ethnicity)
male = newTwo %>% filter(Sex == "M")
female = newTwo %>% filter(Sex == "F")
# All Data
corrplot(cor(newTwo[,c(1,3:8)]))
# Caucasian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Caucasian"),c(1,3:8)]))
# Persian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Persian"),c(1,3:8)]))
# Male
corrplot(cor(male[,c(1,3:8)]))
# Female
corrplot(cor(female[,c(1,3:8)]))
#Investigate linear relation between age and MRD
ggplot(newTwo, aes(x=`MRD-1 (L)`, y=Age,fill=Ethnicity)) + geom_point(aes(color=Ethnicity)) + theme_classic()
ggplot(newAll, aes(x=`MRD-1 (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`MRD-1(R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(male, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
dat_male=data.frame(age=male$Age,'MRD-1(R)/TPS(R) of Male'=male$`MRD-1(R)`/male$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=male$`MRD-1(R)`/male$`PTB (R)`,'PTB(R)/TPS(R)'=male$`PTB (R)`/male$`TPS (R)`)
corrplot(cor(dat_male))
dat_female=data.frame(age=female$Age,'MRD-1(R)/TPS(R) of Male'=female$`MRD-1(R)`/female$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=female$`MRD-1(R)`/female$`PTB (R)`,'PTB(R)/TPS(R)'=female$`PTB (R)`/female$`TPS (R)`)
corrplot(cor(dat_female))
smp_siz = floor(0.8*nrow(newTwo))
set.seed(684323)
train_ind = sample(seq_len(nrow(newTwo)),size = smp_siz)
train = newTwo[train_ind,]
test = newTwo[-train_ind,]
write.csv(train,file="ann_train.csv")
write.csv(test,file="ann_test.csv")
smp_siz = floor(0.8*nrow(male))
train_ind = sample(seq_len(nrow(male)),size = smp_siz)
trainMale = male[train_ind,]
testMale = male[-train_ind,]
smp_siz = floor(0.8*nrow(female))
train_ind = sample(seq_len(nrow(female)),size = smp_siz)
trainFemale = female[train_ind,]
testFemale = female[-train_ind,]
# All
m1 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age + Sex, data = train, family = "binomial")
m2 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` + Age + Sex, data = train, family = "binomial")
m3 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` * Age * Sex, data = train, family = "binomial")
# Male/Female
m4 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainFemale , family = "binomial")
m5 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainMale , family = "binomial")
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
confusionMatrix(table(predict(m1,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m2,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m3,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m4,testFemale[,1:8],type = 'response') >=0.5,testFemale$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m5,testMale[,1:8],type = 'response') >=0.5,testMale$Ethnicity=="Persian"))[3]
## run random effect model to see how the measures are differed by Ethnicity
random_effect_data <- read_csv("./random_effect_data.csv")
random_effect_MRD = lme(`MRD` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB = lme(`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_TPS = lme(`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_TPS = lme(`MRD`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_PTB = lme(`MRD`/`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB_TPS = lme(`PTB`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
summary(random_effect_MRD)
summary(random_effect_PTB)
summary(random_effect_TPS)
summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
library(readxl)
library(dplyr)
library(caret)
library(e1071)
library(corrplot)
library(ggplot2)
library(readr)
library(nlme)
persian.UCLA = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 1)[,2:12]
persian.UCLA = na.omit(persian.UCLA)
persian.UCLA$Ethnicity = "Persian"
caucasian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 2)[,2:12]
caucasian = na.omit(caucasian)
alldata = rbind(persian.UCLA, caucasian)
persian = read_xlsx("PersianVCaucasianEyes.xlsx", sheet = 3)[,2:9]
persian$Age = as.numeric(alldata %>% filter(Ethnicity == "Persian" & Sex == "M") %>% summarise(Age = median(Age)))
persian$Ethnicity = "Persian"
newAll = rbind(alldata[,c(11,2,5:10,1)], persian)
newTwo = alldata[,c(11,2,5:10,1)]
write.csv(newTwo,file="complete.csv")
newTwo$Ethnicity = as.factor(newTwo$Ethnicity)
newAll$Ethnicity = as.factor(newAll$Ethnicity)
persian$Ethnicity = as.factor(persian$Ethnicity)
male = newTwo %>% filter(Sex == "M")
female = newTwo %>% filter(Sex == "F")
# All Data
corrplot(cor(newTwo[,c(1,3:8)]))
# Caucasian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Caucasian"),c(1,3:8)]))
# Persian
corrplot(cor(newTwo[which(newTwo$Ethnicity=="Persian"),c(1,3:8)]))
# Male
corrplot(cor(male[,c(1,3:8)]))
# Female
corrplot(cor(female[,c(1,3:8)]))
#Investigate linear relation between age and MRD
ggplot(newTwo, aes(x=`MRD-1 (L)`, y=Age,fill=Ethnicity)) + geom_point(aes(color=Ethnicity)) + theme_classic()
ggplot(newAll, aes(x=`MRD-1 (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`MRD-1(R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(newAll, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()
ggplot(male, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (L)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (L) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("TPS (R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS (R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`MRD-1(R)`/`PTB (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("MRD-1(R)/PTB(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
ggplot(male, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Male") + theme(plot.title = element_text(hjust = 0.5))
ggplot(female, aes(x=`PTB (R)`/`TPS (R)`, fill=Ethnicity)) + geom_density(alpha=.3)+ theme_classic()+ggtitle("PTB(R)/TPS(R) of Female") + theme(plot.title = element_text(hjust = 0.5))
dat_male=data.frame(age=male$Age,'MRD-1(R)/TPS(R) of Male'=male$`MRD-1(R)`/male$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=male$`MRD-1(R)`/male$`PTB (R)`,'PTB(R)/TPS(R)'=male$`PTB (R)`/male$`TPS (R)`)
corrplot(cor(dat_male))
dat_female=data.frame(age=female$Age,'MRD-1(R)/TPS(R) of Male'=female$`MRD-1(R)`/female$`TPS (R)`,'MRD-1(R)/PTB(R) of Male'=female$`MRD-1(R)`/female$`PTB (R)`,'PTB(R)/TPS(R)'=female$`PTB (R)`/female$`TPS (R)`)
corrplot(cor(dat_female))
smp_siz = floor(0.8*nrow(newTwo))
set.seed(684323)
train_ind = sample(seq_len(nrow(newTwo)),size = smp_siz)
train = newTwo[train_ind,]
test = newTwo[-train_ind,]
write.csv(train,file="ann_train.csv")
write.csv(test,file="ann_test.csv")
smp_siz = floor(0.8*nrow(male))
train_ind = sample(seq_len(nrow(male)),size = smp_siz)
trainMale = male[train_ind,]
testMale = male[-train_ind,]
smp_siz = floor(0.8*nrow(female))
train_ind = sample(seq_len(nrow(female)),size = smp_siz)
trainFemale = female[train_ind,]
testFemale = female[-train_ind,]
# All
m1 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age + Sex, data = train, family = "binomial")
m2 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` + Age + Sex, data = train, family = "binomial")
m3 = glm(Ethnicity ~ `MRD-1 (L)` * `TPS (L)` * `PTB (L)` * Age * Sex, data = train, family = "binomial")
# Male/Female
m4 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainFemale , family = "binomial")
m5 = glm(Ethnicity ~ `MRD-1 (L)` + `PTB (L)` + Age, data = trainMale , family = "binomial")
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
confusionMatrix(table(predict(m1,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m2,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m3,test[,1:8],type = 'response') >=0.5,test$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m4,testFemale[,1:8],type = 'response') >=0.5,testFemale$Ethnicity=="Persian"))[3]
confusionMatrix(table(predict(m5,testMale[,1:8],type = 'response') >=0.5,testMale$Ethnicity=="Persian"))[3]
## run random effect model to see how the measures are differed by Ethnicity
random_effect_data <- read_csv("./random_effect_data.csv")
random_effect_MRD = lme(`MRD` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB = lme(`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_TPS = lme(`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_TPS = lme(`MRD`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_MRD_PTB = lme(`MRD`/`PTB` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
random_effect_PTB_TPS = lme(`PTB`/`TPS` ~ Ethnicity + Sex + Age, random_effect_data, random=~1|Person)
summary(random_effect_MRD)
summary(random_effect_PTB)
summary(random_effect_TPS)
summary(random_effect_MRD_TPS)
summary(random_effect_MRD_PTB)
summary(random_effect_PTB_TPS)
